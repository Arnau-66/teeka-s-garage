<section class="starships-list hangar">
  <div class="hangar__bg" aria-hidden="true"></div>
  <div class="hangar__stars" aria-hidden="true"></div>

  <div class="hangar__panel">

    <div class="back-orbit">
      <a routerLink="/" class="sw-btn orbit-button" aria-label="Back to Orbit">
        <span class="sw-btn__inner">
          <span class="sw-btn__icon" aria-hidden="true">⟵</span>
          <span class="sw-btn__label">Back to Orbit</span>
        </span>
      </a>
    </div>

    @if (loading()) {
      <p aria-live="polite">Loading starships...</p>
    }
    @else if (error()) {
      <div class="error" role="alert" aria-live="assertive">
        <p>Ooops! {{ error() }} </p>
        <button type="button" class="sw-btn" (click)="fetchPage(1)">
          <span class="sw-btn__inner"><span class="sw-btn__label">Retry</span></span>
        </button>
      </div>
    }
    @else {

      <!-- HOLOGRAMA CENTRAL (POR DELANTE DEL PROYECTOR) -->
      <div class="holo-stage" aria-hidden="true">
        @if (starships().length) {
          <img
            [src]="shipImageFrom(starships()[activeIndex()])"
            [attr.alt]="starships()[activeIndex()].name + ' hologram'"
            (error)="onImgError($event)"
          />
          <div class="holo-caption aurebesh">
            {{ starships()[activeIndex()]?.name }}
          </div>
        }
      </div>

      <!-- CONTROLES DEL CARRUSEL (sin lista visible) -->
      <div class="carousel" role="region" aria-roledescription="carousel" aria-label="Starships carousel">
        <button class="car-btn sw-btn car-btn--prev"
                type="button"
                (click)="goPrevInCarousel()"
                [disabled]="activeIndex() === 0"
                aria-label="Previous">
          <span class="sw-btn__inner"><span class="sw-btn__icon">‹</span></span>
        </button>

        <!-- Lista funcional (oculta visualmente, mantiene a11y y lógica) -->
        <ul #rack class="starships rack is-hidden"
            role="listbox"
            [attr.aria-activedescendant]="'ship-' + activeIndex()">
          @for (ship of starships(); track ship.url; let i = $index) {
            <li class="ship-item"
                [attr.data-idx]="i"
                [class.is-active]="i === activeIndex()"
                [id]="'ship-' + i"
                role="option"
                [attr.aria-selected]="i === activeIndex()"
                [attr.aria-current]="i === activeIndex() ? 'true' : null"
                tabindex="-1">
              <span class="sr-only">{{ ship.name }}</span>
            </li>
          } @empty {
            <li class="empty">No starships found.</li>
          }
        </ul>

        <button class="car-btn sw-btn car-btn--next"
                type="button"
                (click)="goNextInCarousel()"
                [disabled]="activeIndex() >= starships().length - 1"
                aria-label="Next">
          <span class="sw-btn__inner"><span class="sw-btn__icon">›</span></span>
        </button>
      </div>

      <div class="pager bottom">
        <button type="button"
                class="sw-btn pager__prev"
                (click)="prevPage()"
                [disabled]="!hasPrev() || loading()">
          <span class="sw-btn__inner"><span class="sw-btn__label">Prev Page</span></span>
        </button>


        <button type="button"
                class="sw-btn pager__next"
                (click)="nextPage()"
                [disabled]="!hasNext() || loading()">
          <span class="sw-btn__inner"><span class="sw-btn__label">More Starships</span></span>
        </button>
      </div>
    }
  </div>

  <!-- HOLOPROYECTOR (queda por detrás) -->
  <div class="holoprojector" aria-hidden="true">
    <img class="holoprojector__img" src="/img/ui/holoprojector.png" alt="">
    <div class="holoprojector__beam"></div>
  </div>
</section>
