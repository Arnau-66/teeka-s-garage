<section class="starships-list hangar">
  <div class="hangar__bg" aria-hidden="true"></div>
  <div class="hangar__stars" aria-hidden="true"></div>

  <div class="hangar__panel">
    <h2>Starships</h2>

    <div class="back-orbit">
      <a routerLink="/" class="orbit-button" aria-label="Return to orbit">
        ⬅ Back to Orbit
      </a>
    </div>

    @if (loading()) {
      <p aria-live="polite">Loading starships...</p>
    }
    @else if (error()) {
      <div class="error" role="alert" aria-live="assertive">
        <p>Ooops! {{ error() }} </p>
        <button type="button" (click)="fetchPage(1)">Retry</button>
      </div>
    }
    @else {

      <!-- HOLOGRAMA CENTRAL (cambia con la card activa) -->
      <div class="holo-stage" aria-hidden="true">
        @if (starships().length) {
          <img
            [src]="shipImageFrom(starships()[activeIndex()])"
            [attr.alt]="starships()[activeIndex()].name + ' hologram large'"
            (error)="onImgError($event)"
          />
          <div class="holo-caption aurebesh">
            {{ starships()[activeIndex()]?.name }}
          </div>
        }
      </div>

      <!-- CARRUSEL “solo hologramas” -->
      <div class="carousel"
           role="region"
           aria-roledescription="carousel"
           aria-label="Starships carousel">
        <button class="car-btn car-btn--prev"
                type="button"
                (click)="goPrevInCarousel()"
                [disabled]="activeIndex() === 0"
                aria-label="Previous">
          ‹
        </button>

        <ul #rack
            class="starships rack"
            role="listbox"
            [attr.aria-activedescendant]="'ship-' + activeIndex()"
            (scroll)="onTrackScroll()">
          @for (ship of starships(); track ship.url; let i = $index) {
            <li class="ship-item"
                [attr.data-idx]="i"
                [class.is-active]="i === activeIndex()"
                [id]="'ship-' + i"
                role="option"
                [attr.aria-selected]="i === activeIndex()"
                [attr.aria-current]="i === activeIndex() ? 'true' : null"
                (click)="setActiveIndex(i)"
                tabindex="-1">

              <!-- Bloque holograma (img + nombre en aurebesh) -->
              <div class="ship-holo" aria-hidden="true">
                <img [src]="shipImageFrom(ship)"
                     [attr.alt]="ship.name + ' hologram'"
                     (error)="onImgError($event)" />
                <div class="ship-name aurebesh">{{ ship.name }}</div>
              </div>

              <!-- Toda la pieza enlaza al detalle (clickable transparente) -->
              <a class="ship-hit"
                 [routerLink]="['/starships', idFromUrl(ship.url)]">
                <span class="sr-only">Open details for {{ ship.name }}</span>
              </a>
            </li>
          } @empty {
            <li class="empty">No starships found.</li>
          }
        </ul>

        <button class="car-btn car-btn--next"
                type="button"
                (click)="goNextInCarousel()"
                [disabled]="activeIndex() >= starships().length - 1"
                aria-label="Next">
          ›
        </button>

        <div class="rack-fade rack-fade--left" aria-hidden="true"></div>
        <div class="rack-fade rack-fade--right" aria-hidden="true"></div>
      </div>

      <div class="sr-only" aria-live="polite">
        {{ starships()[activeIndex()]?.name }} selected
      </div>

      <div class="pager bottom">
        <button type="button" (click)="prevPage()" [disabled]="!hasPrev() || loading()">← Prev</button>
        <span>Page {{ currentPage() }}</span>
        <button type="button" (click)="nextPage()" [disabled]="!hasNext() || loading()">More ships →</button>
      </div>
    }
  </div>
</section>
